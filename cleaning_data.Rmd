---
title: "Cleaning Data"
author: "Danielle Reimanis"
date: "10/17/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
library(dplyr)
library(tidyverse)
library(tidyr)
library(lubridate)
library(xts)
library(dygraphs)
library(raster)
library(USAboundaries)

```

# Cleaning data, selecting relevant observations, joining to long

```{r}

files <- list.files('data',full.names = T)

my_reader <- function(file){
  data_names = str_split_fixed(file,'_',2)[,1]
  name = gsub('data/','',data_names)
  df <- read_csv(file,) %>%
    dplyr::select(address, name, version, logging_interval)%>%
    rename('date' = 1,
           'temp' = 2,
           'humidity' = 3,
           'dewpoint' = 4) %>%
    mutate(temp = as.numeric(temp))%>%
    mutate(humidity = as.numeric(humidity))%>%
    mutate(dewpoint = as.numeric(dewpoint))%>%
    slice(-1,-2)%>%
    mutate(site = name)%>%
    mutate(site = replace(site, list=site=="BN29", values="BM29"))
  return(df)
}

data_clean <- map_dfr(files,my_reader)


```


```{r}

# convert to xts
data_xts <- data_clean_hourly %>%
  mutate(date = ymd_hm(date, tz='MST'))%>%
  arrange(date) %>%
  xts(., order.by = .$date)

#plot in dygraph
# dygraph(data_xts)

```

# Random Fixes
```{r}
#BM42, 43, 44 had dewpoints of 700 and higher, so i removed
dewpoint_analysis <- data_clean %>%
  filter(., !site == "BM42",
         !site == "BM43",
         !site == "BM44")

#bm21 calculated temp every 10 minutes, so I took average to get hourly
bm21_hourly <- data_clean %>%
  filter(site == "BM21")%>%
  mutate(date = ymd_hm(date, tz='MST'))%>%
  mutate(hour = hour(date))%>%
  mutate(day = day(date))%>%
  mutate(month = month(date))%>%
  group_by(site, month, day, hour)%>%
  summarize(mean_temp = mean(temp))%>%
  as.data.frame()%>%
  as.tibble()

```

# Pulling Elevation Data

```{r}



```



```{r}
# looking at temperature only
temp <- data_clean%>%
  dplyr::select(date, temp, site) %>%
  filter(!site == "BM21")%>%
  mutate(date = ymd_hm(date, tz='MST'))

temp_means <- temp %>%
  mutate(month = month(date))%>%
  group_by(month, site)%>%
  summarise(mean_temp = mean(temp))

temp_max <- temp %>%
  mutate(month = month(date))%>%
  group_by(month, site)%>%
  summarise(max_temp = max(temp))

temp_min <- temp %>%
  mutate(month = month(date))%>%
  group_by(month, site)%>%
  summarise(min_temp = min(temp))

ggplot(temp_means, aes(x=month, y=mean_temp, color=site))+
  geom_line()

ggplot(temp_max, aes(x=month, y=max_temp, color=site))+
  geom_line()

ggplot(temp_min, aes(x=month, y=min_temp, color=site))+
  geom_line()
```

# dygraph of temp vs time

```{r}

temp_wide <- temp %>%
  spread(., key='site',
         value='temp')%>%
  filter_if(is.numeric, all_vars(!is.na(.)))

temp_xts <- temp_wide %>%
  xts(., order.by = .$date)

dygraph(data_xts)%>%
  dyAxis('y', label='Temperature (Â°C)', valueRange=c(-15,40))

# min_temp <- temp_wide %>%
#   filter(BM44 == -14.50)

```



```{r}
#location data frame

utmE <- c()

#exploring sites (bn29??)
bn29 <- data_clean %>%
  filter(site == "BN29")

bm21 <- data_clean %>%
  filter(site == "BM21")

```


